<html><head><title>Testbed</title>    <script type="text/javascript" src="http://cdn.sencha.com/ext/gpl/3.4.1.1/adapter/ext/ext-base.js"></script>    <script type="text/javascript" src="http://cdn.sencha.com/ext/gpl/3.4.1.1/ext-all.js"></script>	<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>    <link rel="stylesheet" type="text/css" href="http://cdn.sencha.com/ext/gpl/3.4.1.1/resources/css/ext-all.css" />    <link rel="stylesheet" type="text/css" href="http://cdn.sencha.com/ext/gpl/3.4.1.1/examples/shared/examples.css" />	    <!-- OpenLayers Script -->	<script src="js/OpenLayers.js"></script>	<script src="js/deprecated.js"></script>    <!-- GeoExt Script -->    <script type="text/javascript" src="http://api.geoext.org/1.1/script/GeoExt.js"></script>		<script type="text/javascript" src="js/main.js"></script>	<script type="text/javascript">		// base map layer		var layer = new OpenLayers.Layer.OSM();        var layer2 = new OpenLayers.Layer.WMS( "States, USA - Obesity Rate",                "http://localhost:8080/geoserver/wms",                {   "layers": "cite:stateobesity",                    "format": "image/png",                    "version": "1.1.1",                    "transparent": "TRUE",                    "SLD_BODY": sld                });			// create the combo instance --- date		var data1 = [];		var url = 'http://localhost:8080/geoserver/wfs?service=WFS&version=1.0.0&request=DescribeFeatureType&typename=cite:stateobesity&outputFormat=application/json';		$.ajax({			type : "POST",			url : "php/fields.php",			data : {				url : url				},			success : function(response) {				data1 = JSON.parse(response);				Ext.getCmp("selection1").getStore().loadData(data1);				Ext.getCmp("selection2").getStore().loadData(data1);				//console.log(JSON.parse(response));				//console.log(data1.toString());			}		});					var comboField = new Ext.form.ComboBox(			{				store:  new Ext.data.SimpleStore(							{								fields: ['fields'],								data: data1,								}),				id:     'selection1',				displayField:    'fields',				typeAhead:        true,				mode:             'local',				triggerAction:    'all',				//selectOnFocus:    true,				//allowBlank:       false,				anchor:            '75%',				listeners: {					// public event function here					'select': function(field){						//dateby.mergeNewParams({viewparams: "word2:"+field.getValue().replace(/-/g ,' ')});						//alert(field.getValue().replace(/-/g ,' ')); this is a bug?!						}				}			});				var comboField01= new Ext.form.ComboBox(			{				store:  new Ext.data.SimpleStore(							{								fields: ['fields'],								data: data1,								}),				id:     'selection2',				displayField:    'fields',				typeAhead:        true,				mode:             'local',				triggerAction:    'all',				//selectOnFocus:    true,				//allowBlank:       false,				anchor:            '75%',				//listeners: {					// public event function here					//'select': function(field){						//dateby.mergeNewParams({viewparams: "word2:"+field.getValue().replace(/-/g ,' ')});						//alert(field.getValue().replace(/-/g ,' ')); this is a bug?!						//}				//}			});				// textfield for classification		var textField = new Ext.form.TextField({		  value: '',		  listeners: {			specialkey: function(field, e) {			  // Only update the word map when user hits 'enter'			  if (e.getKey() == e.ENTER) {			var default_val = field.getValue();			var breakpoints = default_val.split(",");			var colors = ['#edf8fb','#b2e2e2','#66c2a4','#2ca25f','#006d2c'];							//new sld style 							var sld_new = '<?xml version="1.0" encoding="ISO-8859-1"?>';	sld_new += '<StyledLayerDescriptor version="1.0.0"'; 	sld_new += '    xsi:schemaLocation="http://www.opengis.net/sld StyledLayerDescriptor.xsd" ';	sld_new += '    xmlns="http://www.opengis.net/sld" ';	sld_new += '    xmlns:ogc="http://www.opengis.net/ogc" ';	sld_new += '    xmlns:xlink="http://www.w3.org/1999/xlink" ';	sld_new += '    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">';	sld_new += '  <NamedLayer>';	sld_new += '    <Name>cite:stateobesity</Name>';	sld_new += '    <UserStyle>';	sld_new += '      <Title>cite:stateobesity</Title>';	sld_new += '      <FeatureTypeStyle>';	sld_new += '        <Rule>';	sld_new += '          <Name>rate1</Name>';	sld_new += '          <Title>Less Than '+ breakpoints[0] + '</Title>';	sld_new += '          <ogc:Filter>';	sld_new += '            <ogc:PropertyIsLessThan>';	sld_new += '              <ogc:PropertyName>obesityR</ogc:PropertyName>';	sld_new += '              <ogc:Literal>'+ breakpoints[0] + '</ogc:Literal>';	sld_new += '            </ogc:PropertyIsLessThan>';	sld_new += '          </ogc:Filter>';	sld_new += '          <PolygonSymbolizer>';	sld_new += '            <Fill>';	sld_new += '              <CssParameter name="fill">'+ colors[0]+'</CssParameter>';	sld_new += '            </Fill>';	sld_new += '          </PolygonSymbolizer>';	sld_new += '        </Rule>';	for (i = 0; i <= breakpoints.length-2; i++){	sld_new += '        <Rule>';	sld_new += '          <Name>rate2</Name>';	sld_new += '          <Title>'+ breakpoints[i]+'to '+ breakpoints[i+1]+'</Title>';	sld_new += '          <ogc:Filter>';	sld_new += '              <ogc:PropertyIsGreaterThanOrEqualTo>';	sld_new += '                <ogc:PropertyName>obesityR</ogc:PropertyName>';	sld_new += '                <ogc:Literal>'+ breakpoints[i]+'</ogc:Literal>';	sld_new += '              </ogc:PropertyIsGreaterThanOrEqualTo>';	sld_new += '              <ogc:PropertyIsLessThan>';	sld_new += '                <ogc:PropertyName>pop</ogc:PropertyName>';	sld_new += '                <ogc:Literal>'+ breakpoints[i+1]+'</ogc:Literal>';	sld_new += '              </ogc:PropertyIsLessThan>';	sld_new += '          </ogc:Filter>';	sld_new += '          <PolygonSymbolizer>';	sld_new += '            <Fill>';	sld_new += '              <CssParameter name="fill">'+ colors[i+1]+'</CssParameter>';	sld_new += '            </Fill>';	sld_new += '          </PolygonSymbolizer>';	sld_new += '        </Rule>';}	sld_new += '        <Rule>';	sld_new += '          <Name>rate5</Name>';	sld_new += '          <Title>Greater Than '+ breakpoints[breakpoints.length-1] + '</Title>';	sld_new += '          <ogc:Filter>';	sld_new += '            <ogc:PropertyIsGreaterThan>';	sld_new += '              <ogc:PropertyName>obesityR</ogc:PropertyName>';	sld_new += '              <ogc:Literal>'+ breakpoints[breakpoints.length-1] + '</ogc:Literal>';	sld_new += '            </ogc:PropertyIsGreaterThan>';	sld_new += '          </ogc:Filter>';	sld_new += '          <PolygonSymbolizer>';	sld_new += '            <Fill>';	sld_new += '              <CssParameter name="fill">'+ colors[colors.length-1]+'</CssParameter>';	sld_new += '            </Fill>';	sld_new += '          </PolygonSymbolizer>';	sld_new += '        </Rule>';	sld_new += '      </FeatureTypeStyle>';	sld_new += '    </UserStyle>';	sld_new += '  </NamedLayer>';	sld_new += '</StyledLayerDescriptor>';//console.log(sld_new);var layer4 = new OpenLayers.Layer.WMS( "States, USA - Obesity Rate",                "http://localhost:8080/geoserver/wms",                {   "layers": "cite:stateobesity",                    "format": "image/png",                    "version": "1.1.1",                    "transparent": "TRUE",                    "SLD_BODY": sld_new                });			var layer_old = viewPort.mapPanel.map.layers[1];            viewPort.mapPanel.map.removeLayer(layer_old);			viewPort.mapPanel.map.addLayer(layer4);			  }			}		  }		});				//-------------------------------------------------------------------------		// GeoEXT Viewport		//-------------------------------------------------------------------------		var viewPort, items = [], controls = [];		Ext.onReady(function() {			viewPort = new Ext.Viewport({				layout: "border",				items: items			});			$('.x-tree-node-cb').attr('type', 'checkbox');		});						// MapPanel 		items.push({			title: 'Testbed',			xtype: "gx_mappanel",			ref: "mapPanel",			region: "center",			height: 400,			width: 600,			tbar: ["Fields:", comboField, comboField01,{				xtype: 'tbbutton',				text: 'Classification',				handler: function() {					//var r = [], rmo =[];					var s1 = Ext.getCmp("selection1").getValue();					var s2 = Ext.getCmp("selection2").getValue();										$.ajax({						type : "POST",						url : "php/classification.php",						data : {							proportyname : [s1,s2]							},						success : function(response) {							var data_ = JSON.parse(response);							//console.log(JSON.parse(response));							//console.log(s1,s2);														var r = data_[0];							var rmo = data_[1];							var matrix = [];							var i = 0;							for (var key in r){								//console.log(r[key], rmo[key]);								matrix[i] = [r[key], rmo[key]];								i=i+1;							}							//console.log(matrix);							var ttests = [];							for(n=0;n<matrix.length -1;n++){								var est1= matrix[n][0], est2 =matrix[n+1][0];								var moe1= matrix[n][1], moe2 =matrix[n+1][1];								var t_test =  Math.abs((est1-est2)/Math.sqrt((moe1/1.645)*(moe1/1.645)+(moe2/1.645)*(moe2/1.645)));								ttests.push(t_test);								//console.log(t_test);							}							//console.log(ttests.sort());							var breakpoints = [23,27,31,33];							var colors = ['#edf8fb','#b2e2e2','#66c2a4','#2ca25f','#006d2c'];							//new sld style 							var sld_new = '<?xml version="1.0" encoding="ISO-8859-1"?>';	sld_new += '<StyledLayerDescriptor version="1.0.0"'; 	sld_new += '    xsi:schemaLocation="http://www.opengis.net/sld StyledLayerDescriptor.xsd" ';	sld_new += '    xmlns="http://www.opengis.net/sld" ';	sld_new += '    xmlns:ogc="http://www.opengis.net/ogc" ';	sld_new += '    xmlns:xlink="http://www.w3.org/1999/xlink" ';	sld_new += '    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">';	sld_new += '  <NamedLayer>';	sld_new += '    <Name>cite:stateobesity</Name>';	sld_new += '    <UserStyle>';	sld_new += '      <Title>cite:stateobesity</Title>';	sld_new += '      <FeatureTypeStyle>';	sld_new += '        <Rule>';	sld_new += '          <Name>rate1</Name>';	sld_new += '          <Title>Less Than '+ breakpoints[0] + '</Title>';	sld_new += '          <ogc:Filter>';	sld_new += '            <ogc:PropertyIsLessThan>';	sld_new += '              <ogc:PropertyName>obesityR</ogc:PropertyName>';	sld_new += '              <ogc:Literal>'+ breakpoints[0] + '</ogc:Literal>';	sld_new += '            </ogc:PropertyIsLessThan>';	sld_new += '          </ogc:Filter>';	sld_new += '          <PolygonSymbolizer>';	sld_new += '            <Fill>';	sld_new += '              <CssParameter name="fill">'+ colors[0]+'</CssParameter>';	sld_new += '            </Fill>';	sld_new += '          </PolygonSymbolizer>';	sld_new += '        </Rule>';	for (i = 0; i <= breakpoints.length-2; i++){	sld_new += '        <Rule>';	sld_new += '          <Name>rate2</Name>';	sld_new += '          <Title>'+ breakpoints[i]+'to '+ breakpoints[i+1]+'</Title>';	sld_new += '          <ogc:Filter>';	sld_new += '              <ogc:PropertyIsGreaterThanOrEqualTo>';	sld_new += '                <ogc:PropertyName>obesityR</ogc:PropertyName>';	sld_new += '                <ogc:Literal>'+ breakpoints[i]+'</ogc:Literal>';	sld_new += '              </ogc:PropertyIsGreaterThanOrEqualTo>';	sld_new += '              <ogc:PropertyIsLessThan>';	sld_new += '                <ogc:PropertyName>pop</ogc:PropertyName>';	sld_new += '                <ogc:Literal>'+ breakpoints[i+1]+'</ogc:Literal>';	sld_new += '              </ogc:PropertyIsLessThan>';	sld_new += '          </ogc:Filter>';	sld_new += '          <PolygonSymbolizer>';	sld_new += '            <Fill>';	sld_new += '              <CssParameter name="fill">'+ colors[i+1]+'</CssParameter>';	sld_new += '            </Fill>';	sld_new += '          </PolygonSymbolizer>';	sld_new += '        </Rule>';}	sld_new += '        <Rule>';	sld_new += '          <Name>rate5</Name>';	sld_new += '          <Title>Greater Than '+ breakpoints[breakpoints.length-1] + '</Title>';	sld_new += '          <ogc:Filter>';	sld_new += '            <ogc:PropertyIsGreaterThan>';	sld_new += '              <ogc:PropertyName>obesityR</ogc:PropertyName>';	sld_new += '              <ogc:Literal>'+ breakpoints[breakpoints.length-1] + '</ogc:Literal>';	sld_new += '            </ogc:PropertyIsGreaterThan>';	sld_new += '          </ogc:Filter>';	sld_new += '          <PolygonSymbolizer>';	sld_new += '            <Fill>';	sld_new += '              <CssParameter name="fill">'+ colors[colors.length-1]+'</CssParameter>';	sld_new += '            </Fill>';	sld_new += '          </PolygonSymbolizer>';	sld_new += '        </Rule>';	sld_new += '      </FeatureTypeStyle>';	sld_new += '    </UserStyle>';	sld_new += '  </NamedLayer>';	sld_new += '</StyledLayerDescriptor>';//console.log(sld_new);var layer3 = new OpenLayers.Layer.WMS( "States, USA - Obesity Rate",                "http://localhost:8080/geoserver/wms",                {   "layers": "cite:stateobesity",                    "format": "image/png",                    "version": "1.1.1",                    "transparent": "TRUE",                    "SLD_BODY": sld_new                });			var layer_old = viewPort.mapPanel.map.layers[1];            viewPort.mapPanel.map.removeLayer(layer_old);			viewPort.mapPanel.map.addLayer(layer3);						}					});					//calculation										//var t-test =  Math.abs((estimate1-estimate2)/Math.sqrt((moe1/1.645)*(moe1/1.645)+(moe2/1.645)*(moe2/1.645)));				}},textField],			map: {				projection: new OpenLayers.Projection("EPSG:900913"),				displayProjection: new OpenLayers.Projection("EPSG:4326"),				units: "m",				numZoomLevels: 19,				controls: controls,				center: new OpenLayers.LonLat(-11163575.09, 4784383.33)			},			zoom: 4,			layers: [layer, layer2],		});				// Tree view of layers (Left)		items.push({			xtype: "treepanel",			ref: "tree",			region: "west",			title: "Layers",			width: 250,			autoScroll: true,			enableDD: true,			collapsible: true,            collapseMode: "mini",			root: new GeoExt.tree.LayerContainer({				text: 'All Layers',				expanded: true				}),			tbar: [			/*{				text: "Add sel. layer to query layers!",				handler: function() {					var node = viewPort.tree.getSelectionModel().getSelectedNode();					if (node && node.layer instanceof OpenLayers.Layer.WMS) {						queryableMapLayers.push(node.layer);					}				}			}*/			]		});				//Legend (Right)		var legendPanel = new GeoExt.LegendPanel({			defaults: {				labelCls: 'mylabel',				style: 'padding:5px'			},			bodyStyle: 'padding:5px',			title: "Legend",			width: 180,			autoScroll: true,			region: 'east'		});		items.push(legendPanel);						// Openlayer map controls 		controls.push(			new OpenLayers.Control.Navigation(), //mouse panning			new OpenLayers.Control.PanPanel(), 			new OpenLayers.Control.ZoomPanel(),				new OpenLayers.Control.MousePosition({                    prefix: '<a target="_blank" ' +                        'href="http://spatialreference.org/ref/epsg/4326/">' +                        'EPSG:4326</a> coordinates: ',                    separator: ' | ',                    numDigits: 2,                    emptyString: 'Mouse is not over map.'                }) //mouse position			//click_info		);					</script></head><body><div id="gxmap"></div></body></html>